# Chess Library in bqn

# Utilities
Rmâ†Â¬âˆ˜âˆŠ/âŠ£
Inâ†âˆŠ/âŠ£
_châ†{(â‰¥âŸœ('A'+32Ã—ğ•—)âˆ§<âŸœ('Z'+32Ã—ğ•—))} # is piece on given side
Iâ†/â—‹â¥ŠâŸœ(â†•â‰¢)
Lcâ†âŠ‘+âŸœ(32Ã—1="A["âŠ¸â‹)
IBâ†{xâ€¿y:(x<8)âˆ§(y<8)âˆ§(xâ‰¥0)âˆ§yâ‰¥0} # In bounds
GBâ†{lâ†âŸ¨âŸ©,ğ•¨âŠ¸{lâˆ¾â†©â‹ˆğ•©,ğ•¨+ğ•©}â€¢_while_ IB ğ•©+ğ•¨,l} # gen bishop

# Chess Board coordinates
# unâ†"â™Ÿâ™Ÿâ™Ÿâ™Ÿâ™Ÿâ™Ÿâ™Ÿâ™Ÿâ™œâ™â™â™›â™šâ™â™â™œâ™™â™™â™™â™™â™™â™™â™™â™™â™–â™˜â™—â™•â™”â™—â™˜â™–"
bâ†[
  "RNBQKBNR"
  "PPPPPPPP"
  "........"
  "........"
  "........"
  "........"
  "pppppppp"
  "rnbqkbnr"
]
mvâ†0 # White: 0

# Find unblocked moves for a piece. Does not look for checks.
UMâ†{
  ğ•Š âŸ¨pc,râ€¿c,b,mvâŸ©:
  Blkâ†{âŸ¨âŸ©:ğ•©;lâ†ğ•©âŠ‘b,ğ•©/Ëœâˆ§`('.'=l)âˆ¨((Â¬mv)_ch l)} # Blocking
  {
     'p':
      fâ†mvâŒ½câˆ¾ËœÂ¨r+1â€¿2Ã—Â¯1â‹†mv # Calculate forward moves
      fâ†©f/Ëœâˆ§`'.'=fâŠ‘b    # remove blocked squares
      dâ†(r+Â¯1â‹†mv)âˆ¾Â¨(<âŸœ8âˆ§â‰¥âŸœ0)Â¨âŠ¸/c+1â€¿Â¯1 # add the captures
      fâˆ¾â†©d/Ëœ(Â¬mv)_ch dâŠ‘b
      f Rm (Â¬mv) _ch b
    ;'r':
      cfâ†râˆ¾Â¨1+c+â†•7-c
      cbâ†âŒ½râˆ¾Â¨â†•c
      rfâ†câˆ¾ËœÂ¨1+r+â†•7-r
      rbâ†âŒ½câˆ¾ËœÂ¨â†•r
      âˆ¾BlkÂ¨ cfâ€¿cbâ€¿rfâ€¿rb
    ;'b':
      âˆ¾(Blk GBâŸœrâ€¿c)Â¨âŸ¨1â€¿1,1â€¿Â¯1,Â¯1â€¿Â¯1,Â¯1â€¿1âŸ©
    ;'n':
      mâ†IBÂ¨âŠ¸/âŸ¨1â€¿2,2â€¿1,1â€¿Â¯2,Â¯2,1,Â¯1â€¿2,2â€¿Â¯1,Â¯1â€¿Â¯2,Â¯2â€¿Â¯1âŸ©+<râ€¿c
      m/ËœÂ¬mv _ch mâŠ‘b
    ;'k':
      mâ†IBÂ¨âŠ¸/âŸ¨0â€¿1,1â€¿1,1â€¿0,1â€¿Â¯1,0â€¿Â¯1,Â¯1â€¿Â¯1,Â¯1â€¿0,Â¯1â€¿1âŸ©+<râ€¿c
      m/ËœÂ¬mv _ch mâŠ‘b
    ;'q':
      âˆ¾UMÂ¨"rb"âˆ¾Â¨<âŸ¨râ€¿c,b,mvâŸ©
    ; Â· :
      â€¢Show "Invalid piece."â€¿ğ•©
  } pc
}

# Find out if a side is in check.
ICâ†{
	ğ•Š bâ€¿mv:
	omvâ†Â¬mv
  csâ†âˆ¾(UMÂ·âˆ¾âŸœbâ€¿omv(LcâŠ‘âŸœb)âŠ¸â‹ˆ)Â¨I omv _ch b
  ksâ†I('K'+32Ã—mv)=b
  âŠ‘ksâˆŠcs
}

# Algebraic coordinates to numeric coordinates
VldA2Nâ†{râ€¿c:((câ‰¥'a')âˆ§câ‰¤'h')âˆ§(râ‰¥'1')âˆ§râ‰¤'8'} # Validity
A2Nâ†-âŸœ"a1"

# Old function for formatting coordinates
# Fmtâ†{wâ€¿wpâ€¿bâ€¿bp: (b-32)âŒ¾(bpâŠ¸âŠ‘)wâŒ¾(wpâŠ¸âŠ‘)8â€¿8â¥Š'.'}

# Long Algebraic Notation to move 
LTâ†A2NË˜2â€¿2âŠ¸â¥Š

Moveâ†{
  râ€¿câ€¿r1â€¿c1â€¿p ğ•Š b: # p is the piece that goes at the end square.
                   # useful for promotion.
  '.'âŒ¾(râ€¿câŠ¸âŠ‘)pâŒ¾(r1â€¿c1âŠ¸âŠ‘)b
}
